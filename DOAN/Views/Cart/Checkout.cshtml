@model DOAN.Models.CheckoutViewModel
@{
    ViewData["Title"] = "Thanh toán";
}

<div class="container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Trang chủ</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Cart")">Giỏ hàng</a></li>
            <li class="breadcrumb-item active" aria-current="page">Thanh toán</li>
        </ol>
    </nav>

    <h2 class="mb-4">Thanh toán</h2>

    <form asp-action="PlaceOrder" method="post">
        <div class="row">
            <!-- Customer Information -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Thông tin giao hàng</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="CustomerName" class="form-label">Họ và tên *</label>
                                <input asp-for="CustomerName" class="form-control" placeholder="Nhập họ và tên">
                                <span asp-validation-for="CustomerName" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="CustomerEmail" class="form-label">Email *</label>
                                <input asp-for="CustomerEmail" class="form-control" placeholder="Nhập email">
                                <span asp-validation-for="CustomerEmail" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="CustomerPhone" class="form-label">Số điện thoại *</label>
                                <input asp-for="CustomerPhone" class="form-control" placeholder="Nhập số điện thoại">
                                <span asp-validation-for="CustomerPhone" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label asp-for="ShippingAddress" class="form-label">Địa chỉ giao hàng *</label>
                            <textarea asp-for="ShippingAddress" class="form-control" rows="3" placeholder="Nhập địa chỉ giao hàng chi tiết"></textarea>
                            <span asp-validation-for="ShippingAddress" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Notes" class="form-label">Ghi chú</label>
                            <textarea asp-for="Notes" class="form-control" rows="2" placeholder="Ghi chú thêm (không bắt buộc)"></textarea>
                            <span asp-validation-for="Notes" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- Payment Method -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Phương thức thanh toán</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod" checked>
                                    <label class="form-check-label d-flex align-items-center" for="cod">
                                        <img src="~/images/payment/cod.svg" alt="COD" class="me-2" style="width: 40px; height: 30px;">
                                        <div>
                                            <div class="fw-bold">Thanh toán khi nhận hàng</div>
                                            <small class="text-muted">(COD)</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="bank" value="bank">
                                    <label class="form-check-label d-flex align-items-center" for="bank">
                                        <img src="~/images/payment/bank.svg" alt="Bank Transfer" class="me-2" style="width: 40px; height: 30px;">
                                        <div>
                                            <div class="fw-bold">Chuyển khoản ngân hàng</div>
                                            <small class="text-muted">Bank Transfer</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="momo" value="momo">
                                    <label class="form-check-label d-flex align-items-center" for="momo">
                                        <img src="~/images/payment/momo.svg" alt="MoMo" class="me-2" style="width: 40px; height: 30px;">
                                        <div>
                                            <div class="fw-bold">Ví điện tử MoMo</div>
                                            <small class="text-muted">Digital Wallet</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Đơn hàng của bạn</h5>
                    </div>
                    <div class="card-body">
                        @foreach (var item in Model.CartItems)
                        {
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="d-flex">
                                    <img src="@item.ProductImageUrl" alt="@item.ProductName" class="rounded me-2" style="width: 50px; height: 50px; object-fit: cover;">
                                    <div>
                                        <h6 class="mb-0">@item.ProductName</h6>
                                        <small class="text-muted">Số lượng: @item.Quantity</small>
                                    </div>
                                </div>
                                <span class="fw-bold">@item.TotalPrice.ToString("N0") ₫</span>
                            </div>
                        }

                        <hr>

                        <div class="d-flex justify-content-between mb-2">
                            <span>Tạm tính:</span>
                            <span>@Model.SubTotal.ToString("N0") ₫</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Phí vận chuyển:</span>
                            <span>@Model.ShippingFee.ToString("N0") ₫</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between mb-3">
                            <strong>Tổng cộng:</strong>
                            <strong class="text-primary">@Model.TotalAmount.ToString("N0") ₫</strong>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-credit-card me-2"></i>Đặt hàng
                            </button>
                            <a href="@Url.Action("Index", "Cart")" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Quay lại giỏ hàng
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Security Info -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="fas fa-shield-alt text-success me-2"></i>Mua sắm an toàn
                        </h6>
                        <ul class="list-unstyled small">
                            <li><i class="fas fa-check text-success me-2"></i>Thông tin được mã hóa SSL</li>
                            <li><i class="fas fa-check text-success me-2"></i>Không lưu trữ thông tin thẻ</li>
                            <li><i class="fas fa-check text-success me-2"></i>Bảo vệ quyền riêng tư</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function() {
            // Form validation
            $('form').on('submit', function(e) {
                var isValid = true;

                // Check required fields
                $('input[required], textarea[required]').each(function() {
                    if (!$(this).val().trim()) {
                        isValid = false;
                        $(this).addClass('is-invalid');
                    } else {
                        $(this).removeClass('is-invalid');
                    }
                });

                if (!isValid) {
                    e.preventDefault();
                    showAlert('danger', 'Vui lòng điền đầy đủ thông tin bắt buộc.');
                }
            });

            function showAlert(type, message) {
                var alertHtml = '<div class="alert alert-' + type + ' alert-dismissible fade show" role="alert">' +
                    message +
                    '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>' +
                    '</div>';

                // Remove existing alerts
                $('.alert').remove();

                // Add new alert at the top
                $('.container').prepend(alertHtml);

                // Auto hide after 5 seconds
                setTimeout(function() {
                    $('.alert').fadeOut();
                }, 5000);
            }
        });
    </script>
}
