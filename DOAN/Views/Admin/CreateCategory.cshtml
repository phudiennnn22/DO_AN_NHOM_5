@model DOAN.Models.Category
@{
    ViewData["Title"] = "Thêm danh mục mới";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-th-large me-2"></i>Thêm danh mục mới
        </h1>
        <a asp-action="Categories" class="btn btn-secondary btn-sm shadow-sm">
            <i class="fas fa-arrow-left fa-sm text-white-50"></i> Quay lại
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Thông tin danh mục</h6>
                </div>
                <div class="card-body">
                    <form asp-action="CreateCategory" method="post" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Name" class="form-label">Tên danh mục *</label>
                                    <input asp-for="Name" class="form-control" placeholder="Nhập tên danh mục" required />
                                    <span asp-validation-for="Name" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Trạng thái</label>
                                    <div class="form-check form-switch">
                                        <input asp-for="IsActive" class="form-check-input" type="checkbox" checked />
                                        <label class="form-check-label" asp-for="IsActive">
                                            Kích hoạt danh mục
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Description" class="form-label">Mô tả</label>
                            <textarea asp-for="Description" class="form-control" rows="4" placeholder="Nhập mô tả cho danh mục (tùy chọn)"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Hình ảnh danh mục</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-2">
                                        <label class="form-label">Upload ảnh từ máy tính</label>
                                        <input type="file" id="imageUpload" class="form-control" accept="image/*" />
                                        <small class="text-muted">Chọn file ảnh từ máy tính của bạn</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-2">
                                        <label asp-for="ImageUrl" class="form-label">Hoặc nhập URL hình ảnh</label>
                                        <input asp-for="ImageUrl" class="form-control" placeholder="https://example.com/image.jpg" />
                                        <small class="text-muted">Nhập URL ảnh từ internet</small>
                                    </div>
                                </div>
                            </div>
                            <span asp-validation-for="ImageUrl" class="text-danger"></span>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a asp-action="Categories" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Hủy
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Tạo danh mục
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Preview hình ảnh</h6>
                </div>
                <div class="card-body text-center">
                    <div id="imagePreview" class="text-muted">
                        <i class="fas fa-image fa-3x mb-3"></i>
                        <p>Chọn ảnh hoặc nhập URL để xem trước</p>
                    </div>
                    <div id="uploadProgress" class="mt-3" style="display: none;">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small class="text-muted">Đang upload...</small>
                    </div>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Ảnh mẫu</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6 mb-2">
                            <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=100&h=100&fit=crop&crop=center" 
                                 class="img-fluid rounded cursor-pointer" 
                                 onclick="setImageUrl('https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=300&h=200&fit=crop&crop=center')"
                                 style="cursor: pointer;" title="Click để chọn - Điện thoại">
                        </div>
                        <div class="col-6 mb-2">
                            <img src="https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=100&h=100&fit=crop&crop=center" 
                                 class="img-fluid rounded cursor-pointer" 
                                 onclick="setImageUrl('https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=300&h=200&fit=crop&crop=center')"
                                 style="cursor: pointer;" title="Click để chọn - Laptop">
                        </div>
                        <div class="col-6 mb-2">
                            <img src="https://images.unsplash.com/photo-1606220945770-b5b6c2c55bf1?w=100&h=100&fit=crop&crop=center" 
                                 class="img-fluid rounded cursor-pointer" 
                                 onclick="setImageUrl('https://images.unsplash.com/photo-1606220945770-b5b6c2c55bf1?w=300&h=200&fit=crop&crop=center')"
                                 style="cursor: pointer;" title="Click để chọn - Phụ kiện">
                        </div>
                        <div class="col-6 mb-2">
                            <img src="https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?w=100&h=100&fit=crop&crop=center" 
                                 class="img-fluid rounded cursor-pointer" 
                                 onclick="setImageUrl('https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?w=300&h=200&fit=crop&crop=center')"
                                 style="cursor: pointer;" title="Click để chọn - Đồng hồ">
                        </div>
                    </div>
                    <small class="text-muted">Click vào ảnh để chọn làm hình ảnh danh mục</small>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Hướng dẫn</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Tên danh mục:</strong> Bắt buộc, tối đa 100 ký tự
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Mô tả:</strong> Tùy chọn, giúp khách hàng hiểu rõ hơn
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Hình ảnh:</strong> Tùy chọn, kích thước khuyến nghị 200x200px
                        </li>
                        <li class="mb-0">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Trạng thái:</strong> Chỉ danh mục hoạt động mới hiển thị
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Preview image from URL
        document.getElementById('ImageUrl').addEventListener('input', function() {
            const url = this.value;
            updateImagePreview(url);
        });

        // Handle file upload
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    alert('Vui lòng chọn file ảnh hợp lệ!');
                    return;
                }

                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Kích thước file không được vượt quá 5MB!');
                    return;
                }

                // Show upload progress
                const progressDiv = document.getElementById('uploadProgress');
                const progressBar = progressDiv.querySelector('.progress-bar');
                progressDiv.style.display = 'block';

                // Simulate upload progress
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    progressBar.style.width = progress + '%';
                    if (progress >= 100) {
                        clearInterval(interval);
                        // Convert to base64 for preview
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const base64 = e.target.result;
                            updateImagePreview(base64);
                            // Set the base64 as URL (for demo purposes)
                            document.getElementById('ImageUrl').value = base64;
                            progressDiv.style.display = 'none';
                        };
                        reader.readAsDataURL(file);
                    }
                }, 100);
            }
        });

        // Function to update image preview
        function updateImagePreview(url) {
            const preview = document.getElementById('imagePreview');
            
            if (url) {
                preview.innerHTML = `
                    <img src="${url}" alt="Preview" class="img-fluid rounded" style="max-height: 200px; max-width: 100%;" 
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div style="display:none;" class="text-muted">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                        <p>Không thể tải hình ảnh</p>
                    </div>
                `;
            } else {
                preview.innerHTML = '<i class="fas fa-image fa-3x mb-3"></i><p>Chọn ảnh hoặc nhập URL để xem trước</p>';
            }
        }

        // Function to set image URL from sample images
        function setImageUrl(url) {
            document.getElementById('ImageUrl').value = url;
            updateImagePreview(url);
        }

        // Form validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const name = document.getElementById('Name').value.trim();

            if (!name) {
                alert('Vui lòng nhập tên danh mục!');
                e.preventDefault();
                return;
            }

            if (name.length > 100) {
                alert('Tên danh mục không được vượt quá 100 ký tự!');
                e.preventDefault();
                return;
            }
        });
    </script>

    <style>
        .cursor-pointer {
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .cursor-pointer:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .form-control:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #0056b3, #004085);
            transform: translateY(-1px);
        }
        
        .card {
            border: none;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }
        
        .card-header {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-bottom: 1px solid #dee2e6;
        }
        
        .progress {
            height: 8px;
            border-radius: 4px;
        }
        
        .progress-bar {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        
        #imagePreview img {
            border: 2px solid #dee2e6;
            border-radius: 8px;
        }
        
        .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
        }
    </style>
}
